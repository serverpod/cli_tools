name: CLI Tools CI

on:
    push:
        branches:
            - main
    pull_request:
        branches:
            - main

jobs:
    dart_format:
        name: Dart format
        strategy:
            matrix:
                dart: [3.3, 3.6]
                package: [cli_tools, config]
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            - uses: dart-lang/setup-dart@v1.7.1
              with:
                sdk: ${{ matrix.dart }}
            - name: Verify formatting ${{ matrix.package }}
              run: dart format --output=none --set-exit-if-changed .
              working-directory: packages/${{ matrix.package }}

    dart_analyze:
        name: Dart Analyze
        strategy:
            matrix:
                dart: [3.3, 3.6]
                package: [cli_tools, config]
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            - uses: dart-lang/setup-dart@v1.7.1
              with:
                sdk: ${{ matrix.dart }}
            - name: Dart get and analyze ${{ matrix.package }}
              run: |
                dart pub get
                dart analyze --fatal-infos
              working-directory: packages/${{ matrix.package }}

    dart_test:
        name: Dart Test
        strategy:
            matrix:
                dart: [3.3, 3.6]
                package: [cli_tools, config]
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            - uses: dart-lang/setup-dart@v1.7.1
              with:
                sdk: ${{ matrix.dart }}
            - name: Dart test ${{ matrix.package }}
              run: dart test
              working-directory: packages/${{ matrix.package }}
